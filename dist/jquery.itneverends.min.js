/*! itneverends - v0.0.5 - 2014-08-24
* https://github.com/osahner/jquery-itneverends
* Copyright (c) 2014 Oliver Sahner <osahner@gmail.com>; Licensed MIT */
!function(a){var b="itneverends";_.templateSettings={evaluate:/\{\{(.+?)\}\}/gm,interpolate:/\{\{=(.+?)\}\}/gm,escape:/\{\{-(.+?)\}\}/gm},a[b]=function(b,c){var d,e={url:"",distance:15,delay:200,loadOnInit:!0,height:"auto",listTemplate:["{{ _.forEach(rows, function(row) { }}",'<li class="list-item">{{- row.name }}</li>',"{{ }); }}"].join(""),loadingTemplate:'<div class="loading"><img src="img/ajax-loader.gif" /></li>',hasMoreFunc:function(){return!1},reqParamsFunc:function(){return{}},loadingDoneFunc:function(){}},f=this,g=!1,h={},i=a(b);f.settings={},f.init=function(){f.settings=a.extend({},e,c),d=_.template(f.settings.listTemplate),i.wrap('<div class="itneverends-container"></div>').addClass("itneverends").css({height:f.settings.height}),i.after(f.settings.loadingTemplate),i.on("scroll",j),f.settings.loadOnInit&&i.trigger("scroll")},f.options=function(b){"object"==typeof b&&(f.settings=a.extend({},f.settings,b),void 0!==b.height&&i.css({height:f.settings.height}),void 0!==b.loadingTemplate&&i.next().html(f.settings.loadingTemplate),void 0!==b.listTemplate&&(d=_.template(f.settings.listTemplate)),void 0!==b.url&&f.reset())},f.reset=function(){var a=i.next();i.off("scroll",j),h={},a.css({opacity:1}),i.children().animate({opacity:0},100,function(){i.html(""),i.on("scroll",j),i.trigger("scroll")})};var j=_.throttle(function(){if(g)return!1;var b=a(this);if(b.scrollTop()+b.innerHeight()>=b[0].scrollHeight-f.settings.distance){var c=i.next();c.css({opacity:1}),g=!0,h=f.settings.reqParamsFunc(h),a.ajax({data:h,url:f.settings.url}).done(function(a){if(a){b.append(d(a));var e=f.settings.hasMoreFunc(a,h);g=!1,c.css({opacity:0}),f.settings.loadingDoneFunc(a),e?b.innerHeight()>=b[0].scrollHeight&&b.trigger("scroll"):b.off("scroll",j)}}).fail(function(){g=!1,c.css({opacity:0}),b.off("scroll",j)})}},f.settings.delay,{leading:!1});f.init()},a.fn[b]=function(){var c,d={};return 1===arguments.length?"string"==typeof arguments[0]?c=arguments[0]:d=arguments[0]:2===arguments.length&&(c=arguments[0],d=arguments[1]),this.each(function(){var e=a(this),f=e.data(b);if(void 0===f){var g=new a.itneverends(this,d);e.data(b,g)}else void 0!==c&&void 0!==f[c]&&f[c](d)})}}(jQuery);