/*! itneverends - v0.0.8 - 2014-09-14
* https://github.com/osahner/jquery-itneverends
* Copyright (c) 2014 Oliver Sahner <osahner@gmail.com>; Licensed MIT */
!function(a,b){var c="itneverends";b.templateSettings={evaluate:/\{\{(.+?)\}\}/gm,interpolate:/\{\{=(.+?)\}\}/gm,escape:/\{\{-(.+?)\}\}/gm},a[c]=function(c,d){var e,f={url:"",distance:15,throttleDelay:200,loadOnInit:!0,height:"auto",listTemplate:["{{ _.forEach(rows, function(row) { }}",'<li class="list-item">{{- row.name }}</li>',"{{ }); }}"].join(""),loadingTemplate:'<div class="loading"><img src="img/ajax-loader.gif" /></li>',hasMore:function(){return!1},requestParams:function(){return{}},loadingDone:function(){}},g=this,h=!1,i={},j=a(c);g.settings={},g.init=function(){g.settings=a.extend({},f,d),e=b.template(g.settings.listTemplate),j.wrap('<div class="itneverends-container"></div>').addClass("itneverends").css({height:g.settings.height}),j.after(g.settings.loadingTemplate),j.on("scroll",k),g.settings.loadOnInit&&j.trigger("scroll")},g.options=function(c){var d=!1;"object"==typeof c&&(g.settings=a.extend({},g.settings,c),void 0!==c.height&&j.css({height:g.settings.height}),void 0!==c.loadingTemplate&&j.next().html(g.settings.loadingTemplate),void 0!==c.listTemplate&&(e=b.template(g.settings.listTemplate),d=!0),void 0!==c.url&&(d=!0),d&&g.reset())},g.reset=function(){var a=j.next();j.off("scroll",k),i={},a.css({opacity:1}),j.children().animate({opacity:0},100,function(){j.html(""),j.on("scroll",k),j.trigger("scroll")})};var k=b.throttle(function(){if(h)return!1;var b=a(this);if(b.scrollTop()+b.innerHeight()>=b[0].scrollHeight-g.settings.distance){var c=j.next();c.css({opacity:1}),h=!0,i=g.settings.requestParams(i),a.ajax({data:i,url:g.settings.url}).done(function(a){if(a){b.append(e(a));var d=g.settings.hasMore(a,i);h=!1,c.css({opacity:0}),g.settings.loadingDone(a),d?b.innerHeight()>=b[0].scrollHeight&&b.trigger("scroll"):b.off("scroll",k)}}).fail(function(a,d,e){h=!1,c.css({opacity:0}),g.settings.loadingDone(e),b.off("scroll",k)})}},g.settings.throttleDelay,{leading:!1});g.init()},a.fn[c]=function(){var b,d={};return 1===arguments.length?"string"==typeof arguments[0]?b=arguments[0]:d=arguments[0]:2===arguments.length&&(b=arguments[0],d=arguments[1]),this.each(function(){var e=a(this),f=e.data(c);if(void 0===f){var g=new a.itneverends(this,d);e.data(c,g)}else void 0!==b&&void 0!==f[b]&&f[b](d)})}}(jQuery,_);